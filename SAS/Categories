/* Step 1: Import the games data */
proc import datafile="steam_data/games.csv"
    out=df_games
    dbms=csv
    replace;
    getnames=yes;
    delimiter=',';
run;

/* Step 2: Import the categories data */
proc import datafile="steam_data/categories.csv"
    out=df_categories
    dbms=csv
    replace;
    getnames=yes;
    delimiter=',';
run;

/* Step 3: Preprocess the games data */
data df_games;
    set df_games;
    /* Convert release_date to SAS date and extract the year */
    release_date_sas = input(release_date, yymmdd10.);
    year = year(release_date_sas);
    
    /* Drop rows with missing year */
    if year = . then delete;
run;

/* Step 4: Merge the categories with the games data */
proc sql;
    create table df_merged as
    select a.app_id, a.year, b.category
    from df_games as a
    inner join df_categories as b
    on a.app_id = b.app_id;
quit;

/* Step 5: Determine the top 10 categories */
proc freq data=df_merged noprint;
    tables category / out=overall_counts (drop=percent);
run;

proc sort data=overall_counts;
    by descending count;
run;

data top10_categories;
    set overall_counts;
    if _N_ <= 10;
run;

proc print data=top10_categories;
    title "Top 10 Categories";
run;

/* Step 6: Aggregate yearly counts for top categories */
proc sql;
    create table category_year_counts as
    select category, year, count(distinct app_id) as count
    from df_merged
    where category in (select category from top10_categories)
    group by category, year;
quit;

/* Step 7: Pivot the data */
proc transpose data=category_year_counts out=pivot_data(drop=_NAME_);
    by year;
    id category;
    var count;
run;

/* Step 8: Plot the growth (rise and fall) of each category */
proc sgplot data=pivot_data;
    series x=year y=game category / markers;
    xaxis label="Year";
    yaxis label="Number of Games Released";
    title "Growth of Top 10 Categories Over the Years";
run;
